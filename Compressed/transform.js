/*
---
license: OSI
authors: Sam Goody <siteroller@gmail.com>
...
*/
var Transform=new Class({Implements:CrossBrowser,initialize:function(){this.pre={chrome:"-webkit",safari:"-webkit",opera:"-o",firefox:"-moz"}[Browser.name]},extendDOM:function(c){var b={},a=this;["transform","matrix","rotate","skew","skewX","skewY","scale","scaleX","scaleY","translate","translateX","translateY"].each(function(e){b[e]=function(d,f,g){if(Type.isArray(f)){g=f;f=null}d=a.getMatrix(e,d,f);a.transform(this,e,d,g);return this}});c?$$(c).each(function(e){Object.merge(e,b)}):Element.implement(b); return this},getMatrix:function(c,b,a){c=c.toLowerCase();var e={c:"",k:"deg",r:"px",o:"deg"}[c.substr(1,1)];if(c=="transform")return this.parseRule(b);if(c=="matrix"){a=Browser.firefox?"px":0;return[b[0],b[2],b[1],b[3],b[4]||0+a,b[5]||0+a]}if(this.pre)return b+e+(a?","+a+e:"");e=c.slice(-1);var d=0.0174532925,f=+(c.substr(0,5)=="scale");if(e=="y"){a=b;b=f;c=c.slice(0,-1)}else if(e=="x"){a=f;c=c.slice(0,-1)}else if(c=="rotate"){d*=b;b=d.sin();a=d.cos()}else a||(a=f?b:0);if(c=="skew"){b=(b*d).tan(); a=(a*d).tan()}return{scale:[b,0,0,a],skew:[1,a,b,1],rotate:[a,b,-b,a],translate:[1,0,0,1,b,a],squeeze:[b,0,0,1/b],project:[0,0,0,1],reflect:[1,0,0,-1],invert:[]}[c]},transform:function(c,b,a,e){if(!this.pre)return this.ieTransform(c,a,e);e=e||[50,50];c.style.position=="static"&&c.setStyle("position","relative");c.setStyle(this.pre+"-transform",b=="transform"?a:b+"("+a+")");c.setStyle(this.pre+"-transform-origin",e[0]+"px "+e[1]+"px")},parseRule:function(c){if(Browser.firefox)return c;if(this.pre== "-webkit")return c.replace(/(matrix\s*\((?:\s*[-\.\d]+\s*,){4})(\s*\d+)[^,]*,(\s*\d+)[^)]*\)/gi,"$1$2,$3)");for(var b,a=[1,0,0,1,0,0],e=/([^(]+)\(([^)]*)\)/gi;b=e.exec(c);){var d=b[1].trim();b=b[2].split(/\s*,\s*/).map(this.convert);d=this.getMatrix(d,b[0],b[1]);a=[a[1]*d[2]+a[0]*d[0],a[2]*d[0]+a[3]*d[2],a[0]*d[1]+a[1]*d[3],a[2]*d[1]+a[3]*d[3],a[0]*d[4]+a[1]*d[5]+a[4],a[2]*d[4]+a[3]*d[5]+a[5]]}return a},convert:function(c){snum=c.trim().split(/(\d+)/);return parseFloat(c)}}); Transform.implement({ieTransform:function(c,b,a){a=a||[50,50];c.setStyle(Browser.ie6?"filter":"-ms-filter",'progid:DXImageTransform.Microsoft.Matrix(M11={a}, M12={c}, M21={b}, M22={d}, SizingMethod="auto expand")'.substitute({a:b[0],b:b[1],c:b[2],d:b[3]}));var e=c.clientWidth/2-a[0],d=c.clientHeight/2-a[1],f=e*b[1]+d*b[3]+a[1]+(b[5]||0)-c.offsetHeight/2;c.style.left=e*b[0]+d*b[2]+a[0]+(b[4]||0)-c.offsetWidth/2;c.style.top=f}});